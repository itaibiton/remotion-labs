---
phase: 26-modal-content-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/creation/creation-detail-panel.tsx
  - src/components/creation/creation-edit-bar.tsx
  - src/lib/date-utils.ts
autonomous: true

must_haves:
  truths:
    - "Details panel shows prompt text in readable format"
    - "Details panel shows thumbnail preview of the animation"
    - "Details panel shows metadata (aspect ratio, duration, FPS, timestamp)"
    - "Details panel has action buttons (save, delete, rerun, extend next/prev)"
    - "Edit bar has textarea for refinement prompts"
    - "Edit bar has submit button that shows loading state"
  artifacts:
    - path: "src/components/creation/creation-detail-panel.tsx"
      provides: "Full detail panel with prompt, thumbnail, metadata, actions"
      min_lines: 80
    - path: "src/components/creation/creation-edit-bar.tsx"
      provides: "Edit bar with textarea, submit button, loading state"
      min_lines: 50
    - path: "src/lib/date-utils.ts"
      provides: "Reusable formatRelativeTime utility"
      exports: ["formatRelativeTime"]
  key_links:
    - from: "src/components/creation/creation-detail-panel.tsx"
      to: "@remotion/player Thumbnail"
      via: "import and render"
      pattern: "import.*Thumbnail.*from.*@remotion/player"
    - from: "src/components/creation/creation-detail-panel.tsx"
      to: "src/lib/date-utils.ts"
      via: "formatRelativeTime import"
      pattern: "import.*formatRelativeTime.*from.*@/lib/date-utils"
---

<objective>
Replace stub components with production implementations for the creation detail modal.

Purpose: UI-02, UI-03, UI-04 require functional detail panel and edit bar components. Phase 25 created stubs; this plan replaces them with full implementations.
Output: Working CreationDetailPanel (prompt, thumbnail, metadata, action buttons) and CreationEditBar (textarea + submit) components.
</objective>

<execution_context>
@/Users/Kohelet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Kohelet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-modal-content-layout/26-RESEARCH.md

# Key source files for patterns
@src/components/generation/generation-row.tsx
@src/components/generation/generation-row-actions.tsx
@src/components/creation/creation-detail-panel.tsx
@src/components/creation/creation-edit-bar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create date utility and implement CreationDetailPanel</name>
  <files>
    src/lib/date-utils.ts
    src/components/creation/creation-detail-panel.tsx
  </files>
  <action>
1. Create `src/lib/date-utils.ts`:
   - Extract `formatRelativeTime` function from generation-row.tsx (lines 43-58)
   - Export as named export for reuse

2. Replace `src/components/creation/creation-detail-panel.tsx` stub with full implementation:

**Props interface:**
```typescript
interface CreationDetailPanelProps {
  generation: Doc<"generations">;
  onSave: () => void;
  onDelete: () => void;
  onRerun: () => void;
  onExtendNext: () => void;
  onExtendPrevious: () => void;
}
```

**Sections to implement:**
- **Prompt section:** Display `generation.prompt` with "Prompt" label (use existing stub pattern)
- **Thumbnail section:** Use `@remotion/player` Thumbnail component with DynamicCode composition
  - Import ASPECT_RATIO_PRESETS from `@/lib/aspect-ratios`
  - Use `frameToDisplay={Math.floor(durationInFrames / 2)}` for mid-animation frame
  - Container: fixed aspect ratio with max-width 200px
  - Only show if `generation.code` exists and status is "success"
- **Metadata section:** Grid layout (2 cols) showing:
  - Aspect ratio: `generation.aspectRatio`
  - Duration: Calculate from `durationInFrames / fps` with "s" suffix
  - FPS: `generation.fps`
  - Created: Use `formatRelativeTime(generation.createdAt)` from date-utils
- **Actions section:** Vertical stack of full-width buttons with icons:
  - Save to Library (Save icon) - calls `onSave`, disabled if no code or failed status
  - Extend Previous (Rewind icon) - calls `onExtendPrevious`, same disabled logic
  - Extend Next (FastForward icon) - calls `onExtendNext`, same disabled logic
  - Rerun (RotateCcw icon) - calls `onRerun`, always enabled
  - Delete (Trash2 icon) - opens AlertDialog confirmation, then calls `onDelete`

**Delete confirmation pattern (from generation-row-actions.tsx):**
- useState for `showDeleteConfirm`
- AlertDialog with title "Delete generation?", description "This cannot be undone."
- Cancel and Delete (destructive variant) buttons

**Styling:**
- Use `p-4 space-y-4` for main container
- Use `text-xs font-medium uppercase text-muted-foreground` for section labels
- Use `text-sm` for content text
- Use `pt-4 border-t` for actions section separator
- Buttons: `variant="outline" size="sm" className="w-full justify-start"`
  </action>
  <verify>
- `npx tsc --noEmit` passes
- File contains Thumbnail import from @remotion/player
- File contains AlertDialog for delete confirmation
- File imports formatRelativeTime from @/lib/date-utils
  </verify>
  <done>
- CreationDetailPanel shows prompt, thumbnail (if code exists), metadata grid, and all action buttons
- Delete action has AlertDialog confirmation
- formatRelativeTime utility extracted to date-utils.ts
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement CreationEditBar with refinement support</name>
  <files>src/components/creation/creation-edit-bar.tsx</files>
  <action>
Replace stub with full implementation:

**Props interface:**
```typescript
interface CreationEditBarProps {
  generationId: string;
  initialPrompt: string;
  onRefine: (prompt: string) => Promise<void>;
  isRefining?: boolean;
}
```

**Implementation:**
1. Local state for `prompt` (string, initially empty)
2. Use existing Textarea component from `@/components/ui/textarea`
3. Use Button component from `@/components/ui/button`

**UI Layout:**
- Horizontal flex container with gap-2
- Textarea:
  - `value={prompt}`
  - `onChange={(e) => setPrompt(e.target.value)}`
  - `placeholder="Describe changes to this animation..."`
  - `className="min-h-[60px] resize-none flex-1"`
  - `rows={2}`
  - `disabled={isRefining}`
  - Keyboard handler: Cmd/Ctrl+Enter submits (e.metaKey || e.ctrlKey) && e.key === "Enter"
- Submit button:
  - Right-aligned, fixed width
  - Shows "Refine" text when idle
  - Shows Loader2 spinning icon when `isRefining`
  - `disabled={!prompt.trim() || isRefining}`
  - `onClick={handleSubmit}`

**handleSubmit function:**
```typescript
const handleSubmit = async () => {
  if (!prompt.trim() || isRefining) return;
  await onRefine(prompt.trim());
  setPrompt(""); // Clear on success
};
```

**Important:** The component does NOT call the refine action directly. It receives `onRefine` callback from parent (CreationModal) which handles the actual API call. This allows the modal to manage loading state and update its own data.
  </action>
  <verify>
- `npx tsc --noEmit` passes
- File has onRefine prop in interface
- File has Cmd/Ctrl+Enter keyboard handler
- File shows Loader2 when isRefining is true
  </verify>
  <done>
- CreationEditBar accepts prompt input and calls onRefine callback
- Cmd/Ctrl+Enter keyboard shortcut submits
- Loading state shown during refinement
- Input clears after successful submission
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. Dev server runs without console errors: `npm run dev`
3. Both components export named functions (not default exports)
4. date-utils.ts is importable from other files
</verification>

<success_criteria>
- CreationDetailPanel displays all 5 sections (prompt, thumbnail, metadata, actions, delete confirm)
- CreationEditBar accepts refinement prompts with keyboard shortcut support
- No TypeScript errors
- Components follow established codebase patterns (shadcn, lucide icons, tailwind)
</success_criteria>

<output>
After completion, create `.planning/phases/26-modal-content-layout/26-01-SUMMARY.md`
</output>
