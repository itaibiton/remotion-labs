---
phase: 04-templates-discovery
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/app/templates/page.tsx
  - src/app/create/page.tsx
  - src/components/templates/template-gallery.tsx
autonomous: false

must_haves:
  truths:
    - "User can browse gallery of template animations at /templates"
    - "User can preview any template in modal before selecting"
    - "User can select template and navigate to /create with template ID"
    - "Selected template shows context banner on create page (informational for v1)"
  artifacts:
    - path: "src/app/templates/page.tsx"
      provides: "/templates route with gallery"
      min_lines: 30
    - path: "src/app/create/page.tsx"
      provides: "Modified create page with template support"
      contains: "getTemplateById"
  key_links:
    - from: "src/app/templates/page.tsx"
      to: "src/components/templates/template-gallery.tsx"
      via: "imports TemplateGallery"
      pattern: "TemplateGallery"
    - from: "src/components/templates/template-gallery.tsx"
      to: "/create"
      via: "router.push with template param"
      pattern: "router\\.push.*template="
    - from: "src/app/create/page.tsx"
      to: "src/lib/templates.ts"
      via: "getTemplateById lookup"
      pattern: "getTemplateById"
---

<objective>
Wire template gallery to /templates page and integrate template selection with /create page.

Purpose: Completes the user flow - users can browse templates, preview them, select one, and land on the create page with template context displayed.
Output: /templates route, modified /create page, complete template selection flow
</objective>

<execution_context>
@/Users/Kohelet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Kohelet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-templates-discovery/04-RESEARCH.md
@.planning/phases/04-templates-discovery/04-01-SUMMARY.md
@src/app/create/page.tsx
@src/lib/templates.ts
@src/components/templates/template-gallery.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /templates page and wire navigation</name>
  <files>
    src/app/templates/page.tsx
    src/components/templates/template-gallery.tsx
  </files>
  <action>
1. Create `src/app/templates/page.tsx`:
   - "use client" directive
   - Import TemplateGallery from "@/components/templates/template-gallery"
   - Import UserMenu from "@/components/auth/user-menu"
   - Import Link from "next/link"
   - Main layout with header (logo + UserMenu) matching create page style
   - Page title: "Templates" with subtitle "Choose a starting point for your animation"
   - Render TemplateGallery component
   - Add Link to /create for "Start from scratch" option below gallery

2. Update `src/components/templates/template-gallery.tsx`:
   - Add import: `import { useRouter } from "next/navigation"`
   - Replace console.log in handleUseTemplate with:
     ```typescript
     const handleUseTemplate = (template: Template) => {
       router.push(`/create?template=${template.id}`);
     };
     ```
   - Pass handleUseTemplate to both TemplatePreview (onUseTemplate) and TemplateCard (onSelect)
  </action>
  <verify>
    `npm run dev` - visit http://localhost:3000/templates, page renders without errors
  </verify>
  <done>
    /templates page renders gallery, clicking "Use Template" navigates to /create?template={id}
  </done>
</task>

<task type="auto">
  <name>Task 2: Modify create page to accept template parameter</name>
  <files>
    src/app/create/page.tsx
  </files>
  <action>
1. Update the server component `src/app/create/page.tsx`:
   - Add searchParams to the page props (Next.js App Router pattern):
     ```typescript
     export default async function CreatePage({
       searchParams,
     }: {
       searchParams: Promise<{ template?: string }>;
     }) {
       const params = await searchParams;
       const templateId = params.template;
       // Pass templateId to CreateContent as a prop
     }
     ```
   - Import `getTemplateById` from "@/lib/templates"
   - Resolve template on server: `const selectedTemplate = templateId ? getTemplateById(templateId) : null`

2. Update CreateContent component:
   - Add `selectedTemplate` prop to CreateContent (type: Template | null)
   - No useSearchParams needed - template comes from server component prop

3. Add template context banner above error/generating/success states:
   ```tsx
   {selectedTemplate && !isGenerating && !lastGeneration && (
     <div className="w-full max-w-2xl mb-6 p-4 bg-muted/50 rounded-lg">
       <div className="flex items-center justify-between">
         <div>
           <p className="text-sm font-medium">
             Using template: {selectedTemplate.name}
           </p>
           <p className="text-xs text-muted-foreground mt-1">
             {selectedTemplate.description}
           </p>
         </div>
         <Link
           href="/templates"
           className="text-xs text-muted-foreground hover:text-foreground underline"
         >
           Change template
         </Link>
       </div>
     </div>
   )}
   ```

4. Update PromptInput placeholder when template selected:
   - Pass optional `placeholder` prop to PromptInput
   - When template selected: "Describe how you'd like to customize this template..."
   - Default: Keep existing placeholder

Note: For v1, template selection displays context to inform the user's prompt. The template's visual style guides what they ask for. Future enhancement could pre-fill animation props directly.
  </action>
  <verify>
    `npm run dev` - visit http://localhost:3000/create?template=bold-announcement, template banner shows without hydration errors
  </verify>
  <done>
    Create page shows template context when ?template= param present (via server component), "Change template" links back to /templates
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete template discovery flow: browse gallery, preview templates, select and navigate to create with context</what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Visit http://localhost:3000/templates
3. Verify: Gallery shows 8 templates in responsive grid
4. Click category tabs - templates filter correctly
5. Click any template card - preview modal opens with animated preview
6. Click "Use This Template" in modal - navigates to /create?template={id}
7. Verify: Create page shows template context banner with name/description
8. Verify: "Change template" link returns to /templates
9. (Optional) Submit a prompt - generation still works normally
  </how-to-verify>
  <resume-signal>Type "approved" if flow works correctly, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` - Next.js build succeeds (no hydration mismatch from useSearchParams)
2. /templates page accessible and renders gallery
3. Template filtering works via tabs
4. Preview modal shows animated template
5. "Use Template" navigates to /create with template ID
6. Create page displays template context when param present
</verification>

<success_criteria>
- User can browse gallery of 8 templates at /templates
- User can filter templates by category using tabs
- User can preview any template in modal with animated preview
- User can select template and land on /create with context banner showing template name/description
- Template context informs prompt writing (v1 - informational display, not prop pre-fill)
- Template selection does not break existing generation flow
</success_criteria>

<output>
After completion, create `.planning/phases/04-templates-discovery/04-02-SUMMARY.md`
</output>
