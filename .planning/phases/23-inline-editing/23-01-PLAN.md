---
phase: 23-inline-editing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/movie/scene-edit-panel.tsx
  - src/components/movie/timeline-scene.tsx
  - .planning/REQUIREMENTS.md
  - .planning/STATE.md
  - .planning/ROADMAP.md
autonomous: true

must_haves:
  truths:
    - "Closing the edit panel with unsaved changes shows a confirmation dialog"
    - "After saving code changes, the timeline thumbnail updates to reflect the new code"
    - "EDIT-01 and EDIT-02 are marked Complete in REQUIREMENTS.md"
    - "Phase 23 is marked complete in ROADMAP.md"
  artifacts:
    - path: "src/components/movie/scene-edit-panel.tsx"
      provides: "Unsaved changes confirmation dialog"
      contains: "AlertDialog"
    - path: "src/components/movie/timeline-scene.tsx"
      provides: "Thumbnail key with updatedAt for cache invalidation"
      contains: "updatedAt"
  key_links:
    - from: "src/components/movie/scene-edit-panel.tsx"
      to: "@/components/ui/alert-dialog"
      via: "import"
      pattern: "import.*AlertDialog"
---

<objective>
Finalize v0.3.0 Movie Editor Revamp with polish fixes and documentation updates

Purpose: Close out the v0.3.0 milestone by addressing the two gaps identified in research (unsaved changes warning, thumbnail cache) and marking requirements complete.

Output: Polished inline edit panel with confirmation dialog, updated thumbnail rendering, and complete documentation.
</objective>

<execution_context>
@/Users/Kohelet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Kohelet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/23-inline-editing/23-RESEARCH.md
@src/components/movie/scene-edit-panel.tsx
@src/components/movie/timeline-scene.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add unsaved changes confirmation dialog</name>
  <files>src/components/movie/scene-edit-panel.tsx</files>
  <action>
Add an AlertDialog from shadcn to warn users when closing the edit panel with unsaved changes.

1. Import AlertDialog components from `@/components/ui/alert-dialog`
2. Add `showDiscardDialog` state (boolean, default false)
3. Modify the Sheet's onOpenChange handler:
   - If closing (open=false) AND hasChanges is true, show the discard dialog instead of closing
   - Otherwise, delegate to parent's onOpenChange
4. Add AlertDialog JSX after the Sheet component:
   - Title: "Discard changes?"
   - Description: "You have unsaved changes. Are you sure you want to close?"
   - Cancel button: Dismisses dialog, keeps panel open
   - Discard button: Closes both dialog and panel

Reference pattern from 23-RESEARCH.md code example.

Note: The AlertDialog component should already exist from shadcn. If not, the executor should run `npx shadcn@latest add alert-dialog` first.
  </action>
  <verify>
1. Open movie page, click Edit on a clip
2. Make a code change (toggle edit mode, modify text)
3. Click X or click outside Sheet - confirmation dialog should appear
4. Click Cancel - dialog closes, panel stays open
5. Click Discard - both dialog and panel close
6. No changes saved (verify by reopening Edit)
  </verify>
  <done>Closing edit panel with unsaved changes shows confirmation dialog with Cancel and Discard options</done>
</task>

<task type="auto">
  <name>Task 2: Add thumbnail key for cache invalidation</name>
  <files>src/components/movie/timeline-scene.tsx</files>
  <action>
Update the Thumbnail component's key prop to include the clip's updatedAt timestamp, forcing a re-render when clip code changes.

1. Locate the Thumbnail component in timeline-scene.tsx
2. Modify the key prop to include updatedAt:
   - Pattern: `key={\`thumb-${clip._id}-${clip.updatedAt ?? 0}\`}`
   - If clip.updatedAt doesn't exist in the type, use `clip._creationTime` or add `?? 0` fallback

This ensures that when a clip's code is updated via the edit panel, the timeline thumbnail re-renders to show the updated first frame.
  </action>
  <verify>
1. Open movie page with a clip
2. Open Edit panel for the clip
3. Make a visible code change (e.g., change a background color)
4. Click Save
5. Observe timeline - thumbnail should update to reflect new code
  </verify>
  <done>Timeline thumbnail updates immediately after saving code changes in the edit panel</done>
</task>

<task type="auto">
  <name>Task 3: Update documentation and mark milestone complete</name>
  <files>.planning/REQUIREMENTS.md, .planning/STATE.md, .planning/ROADMAP.md</files>
  <action>
Update project documentation to mark EDIT-01, EDIT-02, and Phase 23 as complete.

**REQUIREMENTS.md:**
1. Find the v0.3.0 requirements section
2. Mark EDIT-01 checkbox as complete: `- [x] **EDIT-01**:...`
3. Mark EDIT-02 checkbox as complete: `- [x] **EDIT-02**:...`
4. Update TL-03, ACT-03, ACT-04, LAYOUT-01, LAYOUT-02 to [x] if not already done
5. Update the Traceability table:
   - EDIT-01 | Phase 23 | Complete
   - EDIT-02 | Phase 23 | Complete
6. Update Coverage stats: `v0.3.0 requirements: 12/12 complete`
7. Update Last updated line with today's date

**STATE.md:**
1. Update Current Position section:
   - Change "Phase: 22 of 23" to "Phase: 23 of 23 (Finalization) -- COMPLETE"
   - Set "Status: Milestone complete"
   - Update progress bar to 100%: `Progress: ████████████████████████ 100%`
2. Update Session Continuity:
   - Last session: 2026-02-04
   - Stopped at: Completed 23-01-PLAN.md (v0.3.0 complete)
   - Next step: Plan v0.4.0 or ship
3. Add to Milestone History table:
   - v0.3.0 Movie Editor Revamp | 6 | TBD | 12/12 | 2026-02-02 -> 2026-02-04

**ROADMAP.md:**
1. Mark Phase 23 checkbox as complete: `- [x] **Phase 23: Finalization**...`
2. Update Progress table: Phase 23 row -> "1/1", "Complete", "2026-02-04"
3. Update Plans list under Phase 23 details:
   - Change "Plans: TBD" to "Plans: 1 plan"
   - Update plan list: `- [x] 23-01-PLAN.md -- Finalization polish and documentation`
4. Update the Last updated comment at bottom
  </action>
  <verify>
1. Read REQUIREMENTS.md - EDIT-01 and EDIT-02 show [x], coverage shows 12/12 complete
2. Read STATE.md - Phase 23 complete, progress 100%
3. Read ROADMAP.md - Phase 23 marked complete with 1/1 plans
  </verify>
  <done>All documentation updated to reflect v0.3.0 milestone completion with EDIT-01/EDIT-02 marked complete</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run dev` - Application starts without errors
2. Open movie page with 2+ clips
3. Test unsaved changes flow: Edit -> modify -> close -> dialog appears
4. Test thumbnail update flow: Edit -> modify -> save -> thumbnail updates
5. Review docs: REQUIREMENTS.md, STATE.md, ROADMAP.md all show completion
</verification>

<success_criteria>
1. Edit panel shows confirmation dialog when closing with unsaved changes
2. Timeline thumbnails update after saving code changes
3. EDIT-01 and EDIT-02 marked Complete in REQUIREMENTS.md
4. Phase 23 marked Complete in ROADMAP.md
5. STATE.md shows v0.3.0 milestone complete at 100%
6. Application builds and runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/23-inline-editing/23-01-SUMMARY.md`
</output>
