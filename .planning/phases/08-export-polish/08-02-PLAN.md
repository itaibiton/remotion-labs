---
phase: 08-export-polish
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/components/export/export-buttons.tsx
  - src/app/create/create-page-client.tsx
autonomous: false

must_haves:
  truths:
    - "User sees export buttons below preview alongside existing render controls"
    - "User can click 'Export .tsx' to download a single TypeScript file"
    - "User can click 'Export Project' to download a zip with full Remotion scaffold"
    - "Export buttons are only visible when a generation exists"
    - "Downloaded single file contains proper imports and registerRoot"
    - "Downloaded zip contains runnable project (package.json, tsconfig, config, src/)"
  artifacts:
    - path: "src/components/export/export-buttons.tsx"
      provides: "Export button UI with two download options"
      exports: ["ExportButtons"]
    - path: "src/app/create/create-page-client.tsx"
      provides: "Create page with export buttons wired into render controls area"
      contains: "ExportButtons"
  key_links:
    - from: "src/components/export/export-buttons.tsx"
      to: "src/lib/export-single-file.ts"
      via: "import generateSingleFile"
      pattern: "import.*generateSingleFile.*from.*export-single-file"
    - from: "src/components/export/export-buttons.tsx"
      to: "src/lib/export-project-zip.ts"
      via: "import generateProjectZip"
      pattern: "import.*generateProjectZip.*from.*export-project-zip"
    - from: "src/components/export/export-buttons.tsx"
      to: "src/lib/export-utils.ts"
      via: "import downloadTextFile, downloadBlob"
      pattern: "import.*download.*from.*export-utils"
    - from: "src/app/create/create-page-client.tsx"
      to: "src/components/export/export-buttons.tsx"
      via: "import ExportButtons"
      pattern: "import.*ExportButtons.*from.*export"
---

<objective>
Create the export buttons UI component and wire it into the create page's render controls area. Add human verification to confirm both export paths work correctly.

Purpose: This is the user-facing feature -- the buttons that trigger single-file and project zip downloads.
Output: Export buttons component + updated create page + verified export functionality.
</objective>

<execution_context>
@/Users/Kohelet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Kohelet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-export-polish/08-RESEARCH.md
@.planning/phases/08-export-polish/08-01-SUMMARY.md

@src/app/create/create-page-client.tsx
@src/components/render/download-button.tsx
@src/lib/export-single-file.ts
@src/lib/export-project-zip.ts
@src/lib/export-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ExportButtons component</name>
  <files>src/components/export/export-buttons.tsx</files>
  <action>
Create `src/components/export/export-buttons.tsx` as a "use client" component.

**Props interface:**
```typescript
interface ExportButtonsProps {
  rawCode: string;
  prompt: string;
  durationInFrames: number;
  fps: number;
}
```

**Component behavior:**
- Two buttons side by side: "Export .tsx" and "Export Project (.zip)"
- Uses lucide-react icons: `FileCode` for .tsx, `FolderArchive` for zip (or `Package`)
- Uses `Button` from `@/components/ui/button` with `variant="outline"` and `size="sm"`
- Loading state: each button shows a spinner/disabled state while generating the download
- Uses `sonner` toast for success feedback ("File downloaded!" / "Project zip downloaded!")

**Export .tsx handler:**
1. Call `generateSingleFile({ rawCode, prompt, durationInFrames, fps })` from export-single-file.ts
2. Call `downloadTextFile(content, "MyComposition.tsx")` from export-utils.ts
3. Toast success
4. Wrap in try/catch, toast error on failure

**Export Project handler:**
1. Call `generateProjectZip({ rawCode, prompt, durationInFrames, fps })` from export-project-zip.ts (returns Promise&lt;Blob&gt;)
2. Call `downloadBlob(blob, "remotionlab-export.zip")` from export-utils.ts
3. Toast success
4. Wrap in try/catch, toast error on failure

**State:** Use `useState` for `isExportingFile` and `isExportingZip` booleans. Disable the respective button while exporting. The zip export is async (JSZip.generateAsync), so the loading state matters.

**Layout:** Flex row with gap-2. Buttons should be small (size="sm") to fit inline with the existing render controls area.
  </action>
  <verify>
- File `src/components/export/export-buttons.tsx` exists
- `npx tsc --noEmit` passes
- Component exports ExportButtons with correct props interface
  </verify>
  <done>ExportButtons component renders two outline buttons with icons, handles both export paths with loading states and toast feedback, properly imports from all three export-lib files.</done>
</task>

<task type="auto">
  <name>Task 2: Wire ExportButtons into create page</name>
  <files>src/app/create/create-page-client.tsx</files>
  <action>
Modify `src/app/create/create-page-client.tsx` to add export functionality:

1. **Import** `ExportButtons` from `@/components/export/export-buttons`.

2. **Add ExportButtons** to the render controls section. The render controls area is the `div` with `className="mt-4 p-4 bg-muted/50 rounded-lg space-y-4"` (around line 313). Add the ExportButtons inside this section, in the border-t area alongside (or below) the existing "Render (Coming Soon)" button. Place it as a new row within the existing controls:

   After the "Render controls" `div` (the `pt-2 border-t` block), add another `div` with `pt-2 border-t`:
   ```tsx
   {/* Export controls */}
   <div className="pt-2 border-t">
     <div className="flex items-center justify-between">
       <p className="text-sm text-muted-foreground">
         Export source code for standalone use
       </p>
       <ExportButtons
         rawCode={lastGeneration.rawCode}
         prompt={lastPrompt}
         durationInFrames={lastGeneration.durationInFrames}
         fps={lastGeneration.fps}
       />
     </div>
   </div>
   ```

3. **Pass correct props:** `rawCode` from `lastGeneration.rawCode`, `prompt` from `lastPrompt` state, `durationInFrames` and `fps` from `lastGeneration`.

Do NOT modify any other behavior in the create page. The export buttons should only appear when `lastGeneration` exists (they're inside the conditional block that checks `lastGeneration && !isGenerating && !error`).
  </action>
  <verify>
- `npx tsc --noEmit` passes
- ExportButtons import is present in create-page-client.tsx
- ExportButtons receives rawCode, prompt, durationInFrames, fps props
- Export section appears inside the lastGeneration conditional rendering block
  </verify>
  <done>ExportButtons wired into create page render controls area. Buttons appear below preview when generation exists, receiving rawCode, prompt, duration, and fps from generation state.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete export feature: single .tsx file download and full project zip download, wired into create page below preview</what-built>
  <how-to-verify>
    1. Navigate to http://localhost:3000/create
    2. Generate any animation (e.g., "a spinning blue square")
    3. After preview appears, scroll to the controls area below the preview
    4. Verify two export buttons are visible: "Export .tsx" and "Export Project (.zip)" (or similar labels)
    5. Click "Export .tsx":
       - Browser should download a file named "MyComposition.tsx"
       - Open the file and verify it contains:
         a. Header comment "Generated by RemotionLab"
         b. Prompt comment with your text
         c. `import React from "react"` line
         d. `import { ... } from "remotion"` with detected APIs
         e. The component code (no DURATION/FPS comments)
         f. RemotionRoot with Composition wrapper
         g. `registerRoot(RemotionRoot)` at the end
    6. Click "Export Project (.zip)":
       - Browser should download "remotionlab-export.zip"
       - Extract the zip and verify it contains:
         a. `remotionlab-export/` root folder
         b. `src/MyComposition.tsx` (with `export const MyComposition`)
         c. `src/Root.tsx` (with Composition setup)
         d. `src/index.ts` (with registerRoot)
         e. `package.json` (with remotion, react deps)
         f. `tsconfig.json`
         g. `remotion.config.ts`
    7. (Optional) In the extracted project, run `npm install && npx remotion studio` to verify it works
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes for the entire project
2. Export buttons render in the create page below preview
3. Single .tsx download produces valid, complete Remotion file
4. Zip download produces valid, complete Remotion project scaffold
5. Both downloads trigger via browser standard download dialog
6. Toast notifications appear on successful export
7. No console errors during export
</verification>

<success_criteria>
- ExportButtons component exists with two export options
- Create page renders export buttons in render controls area
- Single .tsx export includes: header comments, React import, Remotion API imports (auto-detected), cleaned component body, Composition wrapper, registerRoot
- Zip export includes: 6-file scaffold in remotionlab-export/ folder
- Both downloads work via browser standard download dialog
- Human verified both export paths produce correct output
</success_criteria>

<output>
After completion, create `.planning/phases/08-export-polish/08-02-SUMMARY.md`
</output>
