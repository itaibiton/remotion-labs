---
phase: 13-generation-feed-settings
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/aspect-ratios.ts
  - src/hooks/use-local-storage.ts
  - src/hooks/use-generation-settings.ts
  - src/components/generation/generation-settings.tsx
autonomous: true

must_haves:
  truths:
    - "Settings panel renders three aspect ratio buttons (16:9, 1:1, 9:16) with visual selection state"
    - "User can set duration (1-10 seconds) and FPS (15, 24, 30, 60) from the settings panel"
    - "Settings persist to localStorage and survive page refresh without hydration errors"
    - "Settings initialize with defaults (16:9, 3s, 30fps) on first visit"
  artifacts:
    - path: "src/lib/aspect-ratios.ts"
      provides: "ASPECT_RATIO_PRESETS constant map and AspectRatioKey type"
      exports: ["ASPECT_RATIO_PRESETS", "AspectRatioKey", "DEFAULT_ASPECT_RATIO"]
    - path: "src/hooks/use-local-storage.ts"
      provides: "SSR-safe useLocalStorage hook with useState + useEffect pattern"
      exports: ["useLocalStorage"]
    - path: "src/hooks/use-generation-settings.ts"
      provides: "Generation settings state hook wrapping useLocalStorage"
      exports: ["useGenerationSettings", "GenerationSettings", "DEFAULT_SETTINGS"]
    - path: "src/components/generation/generation-settings.tsx"
      provides: "Settings panel UI with aspect ratio, duration, and FPS controls"
      exports: ["GenerationSettings"]
  key_links:
    - from: "src/hooks/use-generation-settings.ts"
      to: "src/hooks/use-local-storage.ts"
      via: "import useLocalStorage"
      pattern: "useLocalStorage"
    - from: "src/components/generation/generation-settings.tsx"
      to: "src/hooks/use-generation-settings.ts"
      via: "receives settings and updateSetting as props"
      pattern: "aspectRatio|durationInSeconds|fps"
    - from: "src/components/generation/generation-settings.tsx"
      to: "src/lib/aspect-ratios.ts"
      via: "import ASPECT_RATIO_PRESETS for rendering options"
      pattern: "ASPECT_RATIO_PRESETS"
---

<objective>
Create the generation settings infrastructure: aspect ratio presets, SSR-safe localStorage persistence hooks, and a settings panel component with aspect ratio, duration, and FPS controls.

Purpose: Users need to configure generation settings that persist across sessions. This plan creates the hooks and UI component. The settings will be wired into the create page and generate action call in Plan 03.
Output: aspect-ratios.ts, use-local-storage.ts, use-generation-settings.ts, generation-settings.tsx
</objective>

<execution_context>
@/Users/Kohelet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Kohelet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-generation-feed-settings/13-RESEARCH.md

@src/hooks/use-debounced-validation.ts
@src/components/generation/prompt-input.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create aspect ratio presets and localStorage hooks</name>
  <files>src/lib/aspect-ratios.ts, src/hooks/use-local-storage.ts, src/hooks/use-generation-settings.ts</files>
  <action>
1. Create `src/lib/aspect-ratios.ts`:
```typescript
export const ASPECT_RATIO_PRESETS = {
  "16:9": { width: 1920, height: 1080, label: "Landscape" },
  "1:1": { width: 1080, height: 1080, label: "Square" },
  "9:16": { width: 1080, height: 1920, label: "Portrait" },
} as const;

export type AspectRatioKey = keyof typeof ASPECT_RATIO_PRESETS;
export const DEFAULT_ASPECT_RATIO: AspectRatioKey = "16:9";
```

2. Create `src/hooks/use-local-storage.ts` with the SSR-safe pattern:
- Initialize state with `initialValue` (never read localStorage during render)
- Read from localStorage in `useEffect` only (runs after hydration on client)
- Write to localStorage in the setter callback
- Wrap localStorage access in try/catch for quota/security errors
- Type signature: `function useLocalStorage<T>(key: string, initialValue: T): [T, (value: T | ((prev: T) => T)) => void]`

Follow the exact pattern from the research document (Pattern 2). This prevents SSR hydration mismatches.

3. Create `src/hooks/use-generation-settings.ts`:
```typescript
import { useLocalStorage } from "./use-local-storage";

export interface GenerationSettings {
  aspectRatio: "16:9" | "1:1" | "9:16";
  durationInSeconds: number;
  fps: number;
}

export const DEFAULT_SETTINGS: GenerationSettings = {
  aspectRatio: "16:9",
  durationInSeconds: 3,
  fps: 30,
};

const STORAGE_KEY = "remotionlab-generation-settings";

export function useGenerationSettings() {
  const [settings, setSettings] = useLocalStorage<GenerationSettings>(
    STORAGE_KEY,
    DEFAULT_SETTINGS
  );

  const updateSetting = <K extends keyof GenerationSettings>(
    key: K,
    value: GenerationSettings[K]
  ) => {
    setSettings((prev) => ({ ...prev, [key]: value }));
  };

  const resetSettings = () => {
    setSettings(DEFAULT_SETTINGS);
  };

  return { settings, updateSetting, resetSettings };
}
```
  </action>
  <verify>Run `npx tsc --noEmit` from the project root. All three files should compile without type errors. Verify exports are correct by checking that the types are properly resolved.</verify>
  <done>Three files created with correct TypeScript types. useLocalStorage uses SSR-safe useState+useEffect pattern. useGenerationSettings wraps localStorage with typed GenerationSettings interface. ASPECT_RATIO_PRESETS maps ratio keys to width/height/label.</done>
</task>

<task type="auto">
  <name>Task 2: Create generation settings panel component</name>
  <files>src/components/generation/generation-settings.tsx</files>
  <action>
Create `src/components/generation/generation-settings.tsx` as a "use client" component.

The component receives settings state as props (not calling the hook internally) so the parent can manage state:

```typescript
interface GenerationSettingsPanelProps {
  settings: GenerationSettings;
  onUpdateSetting: <K extends keyof GenerationSettings>(key: K, value: GenerationSettings[K]) => void;
  onReset: () => void;
}
```

Layout (all in one collapsible or visible panel):

1. **Aspect Ratio section** - Label "Aspect Ratio" with 3 buttons in a row:
   - Each button shows an icon (Monitor for 16:9, Square for 1:1, Smartphone for 9:16) and the label from ASPECT_RATIO_PRESETS
   - Selected button uses variant="default", others use variant="outline"
   - Import icons from lucide-react: Monitor, Square, Smartphone

2. **Duration section** - Label "Duration" with a row of preset buttons: 1s, 2s, 3s, 5s, 10s
   - Selected duration uses variant="default", others variant="outline"
   - Show seconds as the label (e.g., "3s")

3. **FPS section** - Label "FPS" with buttons: 15, 24, 30, 60
   - Selected FPS uses variant="default", others variant="outline"

4. **Reset button** at the bottom - small text button "Reset to defaults" that calls onReset

Use existing Button component from @/components/ui/button.
Use Tailwind for layout: flex-col with gap-4 for sections, flex-row with gap-2 for button groups.
Keep the component compact -- it will be placed in the create page above or beside the prompt input.

Export as `GenerationSettingsPanel` (not `GenerationSettings` which conflicts with the type).
  </action>
  <verify>Run `npx tsc --noEmit` from the project root. The component should compile without type errors. Verify the import paths resolve correctly.</verify>
  <done>GenerationSettingsPanel component renders aspect ratio, duration, and FPS button groups with visual selection state. Component accepts settings as props for parent-controlled state. Uses existing Button component and lucide-react icons.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. All four files exist with correct exports
3. useLocalStorage never calls window.localStorage outside useEffect
4. GenerationSettingsPanel renders three control groups with selection state
5. No hardcoded 1920x1080 in any new file -- all dimensions come from ASPECT_RATIO_PRESETS
</verification>

<success_criteria>
- ASPECT_RATIO_PRESETS provides typed dimension mapping for 3 ratios
- useLocalStorage is SSR-safe (no hydration mismatch possible)
- useGenerationSettings persists to "remotionlab-generation-settings" localStorage key
- GenerationSettingsPanel is a presentational component receiving props (not calling hooks)
- All controls show visual selection state for current setting value
</success_criteria>

<output>
After completion, create `.planning/phases/13-generation-feed-settings/13-02-SUMMARY.md`
</output>
