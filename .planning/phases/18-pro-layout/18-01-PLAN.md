---
phase: 18-pro-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/resizable.tsx
  - src/components/movie/movie-editor.tsx
  - src/components/movie/movie-preview-player.tsx
  - src/components/movie/timeline.tsx
autonomous: false

must_haves:
  truths:
    - "Movie page fills the entire viewport with no page-level scrolling"
    - "Preview player occupies the top panel and timeline occupies the bottom panel in a vertical split"
    - "User can drag the divider between preview and timeline to resize panel proportions"
    - "Panel proportions persist visually during the session (no jarring resets on re-render)"
  artifacts:
    - path: "src/components/ui/resizable.tsx"
      provides: "shadcn/ui wrapper for react-resizable-panels v4"
      exports: ["ResizablePanelGroup", "ResizablePanel", "ResizableHandle"]
    - path: "src/components/movie/movie-editor.tsx"
      provides: "Pro layout with vertical resizable panel split"
      contains: "ResizablePanelGroup"
    - path: "src/components/movie/movie-preview-player.tsx"
      provides: "Aspect-ratio-constrained player that fills panel"
      contains: "aspectRatio"
    - path: "src/components/movie/timeline.tsx"
      provides: "Timeline that fills its panel without extra padding"
  key_links:
    - from: "src/components/movie/movie-editor.tsx"
      to: "src/components/ui/resizable.tsx"
      via: "import ResizablePanelGroup, ResizablePanel, ResizableHandle"
      pattern: "from.*@/components/ui/resizable"
    - from: "src/components/movie/movie-editor.tsx"
      to: "src/components/movie/movie-preview-player.tsx"
      via: "MoviePreviewPlayer rendered inside top ResizablePanel"
      pattern: "ResizablePanel.*MoviePreviewPlayer"
    - from: "src/components/movie/movie-editor.tsx"
      to: "src/components/movie/timeline.tsx"
      via: "Timeline rendered inside bottom ResizablePanel"
      pattern: "ResizablePanel.*Timeline"
    - from: "src/components/ui/resizable.tsx"
      to: "react-resizable-panels"
      via: "v4 imports (Group, Panel, Separator)"
      pattern: "ResizablePrimitive\\.Group|ResizablePrimitive\\.Panel|ResizablePrimitive\\.Separator"
---

<objective>
Transform the movie editor page from a scrollable document layout into a full-screen professional editor with a vertical resizable panel split: preview player on top, timeline on bottom, with a draggable divider.

Purpose: This is the foundation layout for the v0.3.0 Movie Editor Revamp. All subsequent timeline interactions (trim, split, zoom, per-clip actions, inline editing) depend on this pro layout being in place.
Output: A viewport-filling movie editor with resizable preview/timeline panels powered by react-resizable-panels v4.
</objective>

<execution_context>
@/Users/Kohelet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Kohelet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-pro-layout/18-RESEARCH.md

@src/components/movie/movie-editor.tsx
@src/components/movie/movie-preview-player.tsx
@src/components/movie/timeline.tsx
@src/app/(app)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-resizable-panels and create shadcn/ui resizable wrapper</name>
  <files>
    src/components/ui/resizable.tsx
  </files>
  <action>
1. Install the dependency:
   ```bash
   npm install react-resizable-panels@^4.4.2
   ```

2. Create `src/components/ui/resizable.tsx` with the v4-compatible shadcn/ui wrapper. This maps v4 exports (`Group`, `Panel`, `Separator`) to shadcn naming (`ResizablePanelGroup`, `ResizablePanel`, `ResizableHandle`).

   CRITICAL: Do NOT use `npx shadcn@latest add resizable` -- it generates v3-incompatible code. Write the component manually.

   The wrapper must:
   - Be a "use client" component
   - Import `* as ResizablePrimitive from "react-resizable-panels"` (v4 namespace)
   - Export `ResizablePanelGroup` wrapping `ResizablePrimitive.Group` with className `"flex h-full w-full aria-[orientation=vertical]:flex-col"`
   - Export `ResizablePanel` wrapping `ResizablePrimitive.Panel`
   - Export `ResizableHandle` wrapping `ResizablePrimitive.Separator` with a `withHandle` boolean prop that renders a `GripHorizontal` icon from lucide-react
   - Use `cn()` from `@/lib/utils` for className merging
   - Use `data-slot` attributes for each component
   - Style the handle with `bg-border`, focus-visible ring, and proper ARIA orientation selectors (`aria-[orientation=horizontal]` and `aria-[orientation=vertical]`)
   - The handle grip icon container should rotate 90deg when horizontal: `[&[aria-orientation=horizontal]>div]:rotate-90`

   Reference the exact code from 18-RESEARCH.md "Pattern 1: v4-Compatible shadcn/ui Resizable Wrapper" section.

3. Verify the module resolves:
   ```bash
   npx tsc --noEmit src/components/ui/resizable.tsx 2>&1 | head -20
   ```
  </action>
  <verify>
    - `npm ls react-resizable-panels` shows v4.4.x+ installed
    - `src/components/ui/resizable.tsx` exists and exports `ResizablePanelGroup`, `ResizablePanel`, `ResizableHandle`
    - `npx tsc --noEmit` passes with no errors in the resizable file
  </verify>
  <done>
    react-resizable-panels v4.4+ is installed, and the shadcn/ui resizable wrapper component exists with v4-compatible imports (Group, Panel, Separator) and proper TypeScript types.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor movie editor to pro layout with resizable panels</name>
  <files>
    src/components/movie/movie-editor.tsx
    src/components/movie/movie-preview-player.tsx
    src/components/movie/timeline.tsx
  </files>
  <action>
**A. Refactor `movie-editor.tsx`:**

Replace the current scrollable document layout with a viewport-filling resizable panel layout.

The outer container remains `<div className="flex-1 flex flex-col h-full">`.

1. Keep the header section but make it compact and non-resizable:
   - Change padding from `px-6 py-4` to `px-4 py-3`
   - Add `flex-shrink-0` so it never gets compressed by flex

2. Replace the current `<div className="flex-1 flex flex-col">` content area (which wraps preview + timeline in a flow layout with `px-6 pt-6` / `p-6` padding) with a resizable panel group:

   ```tsx
   <div className="flex-1 min-h-0">
     <ResizablePanelGroup orientation="vertical">
       <ResizablePanel defaultSize="65%" minSize="30%">
         {/* Preview panel inner wrapper */}
         <div className="h-full w-full flex items-center justify-center p-4 overflow-hidden bg-black/5">
           <div style={{ aspectRatio: "1920 / 1080", maxHeight: "100%", maxWidth: "100%" }}>
             <MoviePreviewPlayer ... />
           </div>
         </div>
       </ResizablePanel>
       <ResizableHandle withHandle />
       <ResizablePanel defaultSize="35%" minSize="15%">
         {/* Timeline panel inner wrapper */}
         <div className="h-full overflow-y-auto p-4">
           <Timeline ... />
         </div>
       </ResizablePanel>
     </ResizablePanelGroup>
   </div>
   ```

3. The `min-h-0` on the panel group container is CRITICAL -- without it, the flex child won't shrink below its content height.

4. Import `ResizablePanelGroup`, `ResizablePanel`, `ResizableHandle` from `@/components/ui/resizable`.

5. The empty state (no scenes) should still show within the flex-1 area, NOT inside the resizable panels. Keep the empty state rendering as-is but ensure it fills the available space below the header.

6. The "Add Scene" dialog remains unchanged.

**B. Update `movie-preview-player.tsx`:**

The player currently wraps itself in `<div className="rounded-lg overflow-hidden shadow-lg border">`. This self-contained styling causes issues inside a resizable panel because the player needs to fill the parent's aspect-ratio container, not define its own box.

1. Remove the outer wrapper div (`rounded-lg overflow-hidden shadow-lg border`).
2. The `Player` component should render with just `style={{ width: "100%" }}` as before -- the aspect-ratio container in `movie-editor.tsx` handles sizing.
3. Keep the mounting skeleton (`aspect-video bg-black rounded-lg animate-pulse`) but simplify it to work inside the panel: `<div className="w-full h-full bg-black/10 animate-pulse" />`.
4. Keep the `totalDurationInFrames === 0` guard returning `null`.

**C. Adjust `timeline.tsx`:**

The timeline currently has its own internal padding in the flex container (`p-4 min-h-[140px]`). Since the movie-editor.tsx now provides `p-4` on the inner wrapper, adjust the timeline:

1. Keep the existing DndContext/SortableContext structure unchanged.
2. The main flex container for scenes (`<div className="flex flex-row gap-2 overflow-x-auto p-4 min-h-[140px] bg-muted/20 rounded-lg border border-dashed">`) should keep its own padding and styling since it's a visually distinct track area. No changes needed to padding here.
3. No functional changes to timeline -- it already works correctly.

**Overflow handling note:** react-resizable-panels v4 sets `overflow: hidden` on Panel elements. That's why we use inner wrapper divs inside each ResizablePanel: the preview wrapper uses `overflow-hidden` (clipping is fine for video), and the timeline wrapper uses `overflow-y-auto` (allows scrolling if content overflows).
  </action>
  <verify>
    - `npx tsc --noEmit` passes with no TypeScript errors
    - `npm run build` completes successfully
    - Dev server (`npm run dev`) shows the movie editor page filling the viewport
    - The preview player is in the top panel and timeline is in the bottom panel
    - The drag handle between panels is visible and draggable
  </verify>
  <done>
    Movie editor page fills the viewport with no page-level scrolling. Preview player occupies the top resizable panel (default 65%). Timeline occupies the bottom resizable panel (default 35%). A visible drag handle allows resizing. Panel proportions persist across re-renders within the session.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full-screen movie editor layout with resizable panels. Preview player on top (65%), timeline on bottom (35%), draggable divider between them. The page fills the viewport with no scrolling.</what-built>
  <how-to-verify>
    1. Run `npm run dev` and navigate to a movie page (e.g., /movie/[id] for a movie with at least 2 scenes)
    2. Verify the page fills the entire viewport -- no vertical scrollbar on the page itself
    3. Verify the preview player is in the top section and the timeline is in the bottom section
    4. Verify there is a visible drag handle (horizontal grip icon) between the preview and timeline areas
    5. Drag the handle up and down -- both panels should resize smoothly
    6. Verify the preview player maintains its 16:9 aspect ratio when the top panel is resized (it should center-fit, not stretch)
    7. Verify the timeline remains scrollable horizontally if there are many scenes
    8. Navigate away from the movie page and back -- verify the layout renders correctly without flash/jump
    9. Test with an empty movie (no scenes) -- should show the "No scenes yet" empty state, not broken panels
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `npm ls react-resizable-panels` shows v4.4.x+
2. `npx tsc --noEmit` passes
3. `npm run build` succeeds
4. Movie editor page renders full-viewport with two resizable panels
5. Drag handle is visible and functional
6. Preview player maintains aspect ratio inside panel
7. Empty movie state still renders correctly
</verification>

<success_criteria>
- LAYOUT-01: Movie page uses a full-screen pro layout with resizable panels (preview on top, timeline at bottom)
- LAYOUT-02: Panels are resizable via drag handles (user can adjust preview vs timeline proportions)
- All 4 roadmap success criteria met:
  1. Movie page fills entire viewport with no page-level scrolling
  2. Preview player on top, timeline on bottom in vertical split
  3. Draggable divider resizes panel proportions
  4. Panel proportions persist visually during the session
</success_criteria>

<output>
After completion, create `.planning/phases/18-pro-layout/18-01-SUMMARY.md`
</output>
