---
phase: 25-modal-shell-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/creation/creation-detail-panel.tsx
  - src/components/creation/creation-edit-bar.tsx
  - src/components/creation/variation-stack.tsx
  - src/components/creation/creation-modal.tsx
autonomous: false

must_haves:
  truths:
    - "Pressing Escape closes the modal and returns to the feed"
    - "Clicking outside the modal (on the backdrop) closes it and returns to the feed"
    - "Left/right arrow keys navigate to the previous/next creation in the feed"
    - "Navigation stops at feed boundaries (first/last creation)"
  artifacts:
    - path: "src/components/creation/creation-detail-panel.tsx"
      provides: "Stub for details panel (replaced in Phase 26)"
      min_lines: 15
    - path: "src/components/creation/creation-edit-bar.tsx"
      provides: "Stub for edit bar (replaced in Phase 26)"
      min_lines: 15
    - path: "src/components/creation/variation-stack.tsx"
      provides: "Stub for variation stack (replaced in Phase 28)"
      min_lines: 15
  key_links:
    - from: "src/components/creation/creation-modal.tsx"
      to: "@radix-ui/react-dialog"
      via: "onEscapeKeyDown and onPointerDownOutside props"
      pattern: "onEscapeKeyDown.*handleClose"
    - from: "src/components/creation/creation-modal.tsx"
      to: "next/navigation router"
      via: "router.replace() for arrow navigation"
      pattern: "router\\.replace"
---

<objective>
Create stub components that allow CreationModal to compile, then verify all modal shell behaviors (Escape dismiss, backdrop click dismiss, arrow key navigation).

Purpose: Phase 24 built the routing infrastructure; Phase 25 makes the modal shell functional and testable. The core behaviors already exist in CreationModal but cannot be tested until missing imports are resolved.

Output: Working modal that can be opened from feed, dismissed via Escape/backdrop click, and navigated via arrow keys.
</objective>

<execution_context>
@/Users/Kohelet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Kohelet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-modal-shell-navigation/25-RESEARCH.md
@.planning/phases/24-route-infrastructure/24-01-SUMMARY.md
@src/components/creation/creation-modal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create stub components for CreationModal imports</name>
  <files>
    src/components/creation/creation-detail-panel.tsx
    src/components/creation/creation-edit-bar.tsx
    src/components/creation/variation-stack.tsx
  </files>
  <action>
Create three minimal stub components that match the interfaces expected by CreationModal:

1. **creation-detail-panel.tsx**
   - Props: `{ generation: Generation }` (use the type from convex schema)
   - Render: A simple placeholder div with text "Details panel - Phase 26"
   - Include the generation's prompt text so it's visible during testing

2. **creation-edit-bar.tsx**
   - Props: `{ generationId: string; initialPrompt: string }`
   - Render: A simple input or textarea with the initialPrompt as placeholder
   - Make it focusable so arrow key guarding can be tested

3. **variation-stack.tsx**
   - Props: `{ variations: Generation[]; parentId: string }`
   - Render: A simple list showing variation count
   - Note: This is optional UI (only shows when variations exist)

Each stub should:
- Be a "use client" component
- Export the named component matching the import in creation-modal.tsx
- Have minimal styling using existing Tailwind classes
- Include a comment marking it as a stub for the respective future phase

DO NOT implement full functionality - these are placeholder stubs that will be replaced in Phases 26-28.
  </action>
  <verify>
Run `npx tsc --noEmit` - no errors should appear for the creation-modal imports.
  </verify>
  <done>
TypeScript compiles without errors for the creation components. The modal page can be loaded in the browser.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Modal shell with dismiss and navigation behaviors</what-built>
  <how-to-verify>
1. Start the dev server: `npm run dev`
2. Navigate to the feed/create page
3. Click on a generation card to open the modal

**Test NAV-03 (Escape closes modal):**
- With the modal open, press the Escape key
- Expected: Modal closes and URL returns to /create (or /feed)
- Verify the feed is visible again without the modal overlay

**Test NAV-04 (Backdrop click closes modal):**
- Click a generation card to open the modal again
- Click on the dark backdrop outside the modal content area
- Expected: Modal closes and URL returns to the feed

**Test NAV-05 (Arrow key navigation):**
- Open a modal for a generation that is NOT the first or last in the feed
- Press the Left arrow key
- Expected: URL changes to the previous generation, modal shows new content
- Press the Right arrow key twice
- Expected: Returns to original, then moves to the next generation
- Note: Up/Down arrows should work the same as Left/Right

**Test boundary behavior (first/last):**
- Navigate to the FIRST generation in the feed (newest)
- Press Left arrow
- Expected: Nothing happens (no navigation past the edge)
- Navigate to the LAST generation in the feed (oldest)
- Press Right arrow
- Expected: Nothing happens (no navigation past the edge)

**Test input guard:**
- Open any modal
- Click in the edit textarea/input at the top
- Press Left/Right arrow keys while focused on input
- Expected: Cursor moves in text field, modal does NOT navigate

**Test history behavior:**
- Open a modal, navigate left/right a few times
- Click browser Back button
- Expected: Modal closes (returns to feed), does NOT cycle through previously viewed modals
  </how-to-verify>
  <resume-signal>Type "approved" if all behaviors work correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
All four success criteria are met:
1. NAV-03: Escape key closes modal and navigates back to feed
2. NAV-04: Backdrop click closes modal and navigates back to feed
3. NAV-05: Arrow keys navigate between creations
4. Boundary handling: Navigation stops at first/last creation (doesn't wrap or error)
</verification>

<success_criteria>
- TypeScript compiles without errors
- Modal opens when clicking a feed card
- Escape key closes the modal
- Clicking backdrop closes the modal
- Arrow keys navigate between creations
- Navigation stops at boundaries (first/last)
- Arrow keys don't interfere when typing in input fields
- Browser back button returns to feed (not through modal history)
</success_criteria>

<output>
After completion, create `.planning/phases/25-modal-shell-navigation/25-01-SUMMARY.md`
</output>
